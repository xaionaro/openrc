Description: Fix FTBFS in Hurd
Author: Thomas Goirand <zigo@debian.org>, Svante Signell <svante.signell@gmail.com>
Forwarded: no
Last-Update: 2014-01-06

--- a/src/includes/rc-misc.h	2013-10-29 12:22:05.000000000 +0100
+++ b/src/includes/rc-misc.h	2013-10-29 13:47:33.000000000 +0100
@@ -38,6 +38,10 @@
 #include <string.h>
 #include <unistd.h>
 
+#ifndef PATH_MAX
+#define PATH_MAX 4096
+#endif
+
 #include "helpers.h"
 
 #define RC_LEVEL_BOOT           "boot"
--- a/src/librc/librc.h	2013-10-29 12:22:05.000000000 +0100
+++ b/src/librc/librc.h	2013-10-29 13:28:44.000000000 +0100
@@ -57,11 +57,20 @@
 #include <time.h>
 #include <unistd.h>
 
-#ifdef BSD
+#if defined(BSD) && !defined(__GNU__)
 #include <sys/param.h>
 #include <sys/user.h>
 #include <sys/sysctl.h>
 #include <kvm.h>
+#else
+#include <sys/param.h>
+#endif
+
+#ifndef PATH_MAX
+#define PATH_MAX 4096
+#endif
+#ifndef MAXPATHLEN
+#define MAXPATHLEN 4096
 #endif
 
 #include "rc.h"
--- a/src/rc/mountinfo.c	2013-10-29 12:28:00.000000000 +0100
+++ b/src/rc/mountinfo.c	2013-10-29 13:43:56.000000000 +0100
@@ -35,11 +35,11 @@
 #  include <sys/ucred.h>
 #  include <sys/mount.h>
 #  define F_FLAGS f_flags
-#elif defined(BSD)
+#elif defined(BSD) && !defined(__GNU__)
 #  include <sys/statvfs.h>
 #  define statfs statvfs
 #  define F_FLAGS f_flag
-#elif defined (__linux__) || defined (__GLIBC__)
+#elif defined (__linux__) || defined (__GLIBC__) || defined(__GNU__)
 #  include <mntent.h>
 #endif
 
@@ -168,7 +168,7 @@
 	return -1;
 }
 
-#ifdef BSD
+#if defined(BSD) && !defined(__GNU__)
 
 /* Translate the mounted options to english
  * This is taken directly from FreeBSD mount.c */
